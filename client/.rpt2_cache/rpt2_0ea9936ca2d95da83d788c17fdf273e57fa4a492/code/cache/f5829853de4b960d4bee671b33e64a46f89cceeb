{
  "code": "import { SaveManager, ModelStorage } from \"../../../../manager/SaveManager\";\r\nimport { gift_Cfg, Effect_Cfg } from \"../../../../manager/ConfigManager\";\r\nimport { CommonDefine } from \"../../../../common/CommonDefine\";\r\nimport { Avatars } from \"../../../../effect/Avatars\";\r\nexport class getGoods {\r\n    constructor(pro) {\r\n        this.storage_time = 0;\r\n        this.eff = null;\r\n        this.init();\r\n        this._pro = pro;\r\n    }\r\n    init() {\r\n        this.getStorage();\r\n        this.goTime();\r\n    }\r\n    isGetGoods() {\r\n        let _new_time = Laya.Browser.now() / 1000;\r\n        let _dTime = _new_time - this.storage_time;\r\n        let mm = this.curGoodsTime * 60;\r\n        if (_dTime >= mm) {\r\n            Laya.timer.clearAll(this);\r\n            Laya.stage.event(CommonDefine.EVENT_MAIN_GOODS_EVENT, [true, 0, this.curGoodsId, this.curGoodsNum]);\r\n        }\r\n        else {\r\n            Laya.stage.event(CommonDefine.EVENT_MAIN_GOODS_EVENT, [false, mm - _dTime, this.curGoodsId, this.curGoodsNum]);\r\n        }\r\n        return [_dTime, mm];\r\n    }\r\n    startTime() {\r\n        let _d = gift_Cfg[this.curId + 1];\r\n        this.curId = _d ? this.curId + 1 : this.curId;\r\n        this.setTime();\r\n        this.goTime();\r\n    }\r\n    goTime() {\r\n        Laya.timer.loop(1000, this, () => {\r\n            let arr = this.isGetGoods();\r\n            this.setProValue(arr[0], arr[1]);\r\n            if (arr[0] >= arr[1]) {\r\n                if (this.eff) {\r\n                    this.eff.Destroy();\r\n                    this.eff = null;\r\n                }\r\n                return;\r\n            }\r\n            let _x = this._pro.x + this._pro.width * this._pro.value;\r\n            let _y = this._pro.y;\r\n            if (!this.eff) {\r\n                this.eff = new Avatars(this._pro.parent);\r\n                this.eff.Load(Effect_Cfg[6].streffect, 1, 1, _x, _y, Laya.Handler.create(this, () => {\r\n                    this.eff.Play(Effect_Cfg[6].straniname, true, true, null);\r\n                }));\r\n            }\r\n            else {\r\n                this.eff.setPostion(_x, _y);\r\n            }\r\n        });\r\n    }\r\n    setProValue(cTime, sTime) {\r\n        let _vaule = cTime / sTime;\r\n        this._pro.value = _vaule;\r\n    }\r\n    setTime() {\r\n        let data = {\r\n            time: Laya.Browser.now() / 1000,\r\n            curId: this.curId,\r\n        };\r\n        SaveManager.getInstance().SetGoodsTime(data);\r\n        this.getStorage();\r\n    }\r\n    getStorage() {\r\n        let data = SaveManager.getInstance().GetCache(ModelStorage.SgoodsTime);\r\n        if (data) {\r\n            this.storage_time = data.time;\r\n            this.curId = data.curId;\r\n        }\r\n        else {\r\n            this.storage_time = Laya.Browser.now() / 1000;\r\n            this.curId = 1;\r\n            let data = {\r\n                time: this.storage_time,\r\n                curId: this.curId,\r\n            };\r\n            SaveManager.getInstance().SetGoodsTime(data);\r\n        }\r\n        this.curGoodsId = gift_Cfg[this.curId].itemID;\r\n        this.curGoodsTime = gift_Cfg[this.curId].time;\r\n        this.curGoodsNum = gift_Cfg[this.curId].num;\r\n    }\r\n}\r\n//# sourceMappingURL=GetGoods.js.map",
  "references": [
    "E:/project/duorou/client/src/manager/SaveManager.ts",
    "E:/project/duorou/client/src/manager/ConfigManager.ts",
    "E:/project/duorou/client/src/common/CommonDefine.ts",
    "E:/project/duorou/client/src/effect/Avatars.ts"
  ],
  "map": "{\"version\":3,\"file\":\"GetGoods.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/game/ui/Main/GetGoods/GetGoods.ts\"],\"names\":[],\"mappings\":\"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\"}"
}
