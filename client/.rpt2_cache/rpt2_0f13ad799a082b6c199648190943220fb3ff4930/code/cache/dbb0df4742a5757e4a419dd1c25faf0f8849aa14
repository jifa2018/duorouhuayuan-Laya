{
  "code": "import { NpcBase } from \"./NpcBase\";\r\nimport { MoveController } from \"../script/MoveController\";\r\nvar Handler = Laya.Handler;\r\nimport { ResourceManager } from \"../../manager/ResourceManager\";\r\nimport { AnimatorController } from \"../script/AnimatorController\";\r\nimport { Utils } from \"../../utils/Utils\";\r\nimport { NorVisitorAI } from \"../ai/NorVisitorAI\";\r\nimport { VisitorProgressBar } from \"../ui/ProgressBar/VisitorProgressBar\";\r\nimport GameScene from \"../scene/GameScene\";\r\nimport { NpcManager } from \"../../manager/NpcManager\";\r\nimport { BubbleCreater } from \"../ui/Bubble/BubbleCreater\";\r\nexport class VisitorNpc extends NpcBase {\r\n    constructor() {\r\n        super();\r\n        this.firstClick = false;\r\n    }\r\n    createById(tableId) {\r\n        super.createById(tableId);\r\n        this.clickIndex = 0;\r\n        this.firstClick = false;\r\n        this.loadModel();\r\n    }\r\n    loadModel() {\r\n        ResourceManager.getInstance().getResource(this._tableData.strmodelurl, Handler.create(this, (node) => {\r\n            if (!node) {\r\n                console.log(\"NPC模型没有加载完成！\");\r\n            }\r\n            this.sprite3dNode = node;\r\n            this.Camera = Utils.FindTransfrom(this.sprite3dNode, \"Prop_xiangji\");\r\n            this._animator = this.addComponent(AnimatorController);\r\n            this._moveController = this.addComponent(MoveController);\r\n            Laya.timer.callLater(this, () => {\r\n                this._aiController = this.addComponent(NorVisitorAI);\r\n                this._moveController.changSpeed(this.Cruise_speed);\r\n            });\r\n            this.clickEnable = Boolean(this._tableData.click);\r\n            this.addChild(this.sprite3dNode);\r\n            if (this.type == 3) {\r\n                this.SetModelAlpha(0.2);\r\n            }\r\n        }));\r\n    }\r\n    GetCamera() {\r\n        super.GetCamera();\r\n        return this.Camera;\r\n    }\r\n    onClick() {\r\n        if (this.type == 1)\r\n            return;\r\n        if (this.type == 3 || this.type == 4 || this.type == 2) {\r\n            super.onClick();\r\n            this.clickIndex++;\r\n            BubbleCreater.instance._bubbleList.forEach(element => {\r\n                if (element.owner == this)\r\n                    BubbleCreater.instance.removeBubble(element);\r\n            });\r\n            if (!this.firstClick) {\r\n                this.CreatProgressBar();\r\n                return;\r\n            }\r\n            if (this._ProgressBar) {\r\n                this._ProgressBar.setProgress(this.clickIndex * 0.1);\r\n                if (this.clickIndex >= 10) {\r\n                    this.clickEnable = false;\r\n                    this._ProgressBar.destroy();\r\n                    if (this.type == 3 || this.type == 4) {\r\n                        this.disappear();\r\n                        if (this.type == 4 && this._aiController != null)\r\n                            this._aiController.ClickTypeFourNpc();\r\n                    }\r\n                }\r\n                if (this.type == 2 && this._aiController != null) {\r\n                    this._aiController.ClickTypeThreeNpc(this.clickIndex);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    CreatProgressBar() {\r\n        this.firstClick = true;\r\n        if (this.type == 3) {\r\n            this._moveController.changSpeed(5);\r\n            this.pickUpMoneySpeed = 500;\r\n        }\r\n        this._ProgressBar = new VisitorProgressBar();\r\n        this._ProgressBar.init(GameScene.instance.camera, this, Handler.create(this, function () {\r\n            this._ProgressBar.setProgress(this.clickIndex * 0.1);\r\n        }));\r\n        if (this.type == 2 && this._aiController != null) {\r\n            this._aiController.ClickTypeThreeNpc(this.clickIndex);\r\n        }\r\n    }\r\n    ActionDone() {\r\n        super.ActionDone();\r\n        this.firstClick = false;\r\n        this.clickIndex = 0;\r\n    }\r\n    isHaveProgressBar() {\r\n        super.isHaveProgressBar();\r\n        if (this._ProgressBar) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    disappear() {\r\n        super.disappear();\r\n        this.clickEnable = false;\r\n        this._ProgressBar && this._ProgressBar.destroy();\r\n        this._ProgressBar = null;\r\n    }\r\n    clear() {\r\n        this.sprite3dNode.destroy();\r\n        this.removeSelf();\r\n        this._animator.destroy();\r\n        this._moveController.destroy();\r\n        this._aiController.destroy();\r\n        this._ProgressBar && this._ProgressBar.destroy();\r\n        this._animator = null;\r\n        this._moveController = null;\r\n        this._aiController = null;\r\n        this._ProgressBar = null;\r\n        BubbleCreater.instance._bubbleList.forEach(element => {\r\n            if (element.owner == this)\r\n                BubbleCreater.instance.removeBubble(element);\r\n        });\r\n        Laya.timer.clearAll(this);\r\n    }\r\n    onMove() {\r\n        super.onMove();\r\n    }\r\n    onStop() {\r\n        super.onStop();\r\n        this.clear();\r\n        NpcManager.getInstance().recoverNpc(\"NpcBase\", this);\r\n    }\r\n    onUpdate() {\r\n        super.onUpdate();\r\n    }\r\n    onDestroy() { }\r\n}\r\n//# sourceMappingURL=VisitorNpc.js.map",
  "references": [
    "E:/project/duorou/client/src/game/npc/NpcBase.ts",
    "E:/project/duorou/client/src/game/script/MoveController.ts",
    "E:/project/duorou/client/src/manager/ResourceManager.ts",
    "E:/project/duorou/client/src/game/script/AnimatorController.ts",
    "E:/project/duorou/client/src/utils/Utils.ts",
    "E:/project/duorou/client/src/game/ai/NorVisitorAI.ts",
    "E:/project/duorou/client/src/game/ui/ProgressBar/VisitorProgressBar.ts",
    "E:/project/duorou/client/src/game/scene/GameScene.ts",
    "E:/project/duorou/client/src/manager/NpcManager.ts",
    "E:/project/duorou/client/src/game/ui/Bubble/BubbleCreater.ts"
  ],
  "map": "{\"version\":3,\"file\":\"VisitorNpc.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/game/npc/VisitorNpc.ts\"],\"names\":[],\"mappings\":\"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\"}"
}
