{
  "code": "var Script3D = Laya.Script3D;\r\nvar Vector3 = Laya.Vector3;\r\nvar Animator = Laya.Animator;\r\nimport { CommonDefine } from \"../../common/CommonDefine\";\r\nexport class MoveController extends Script3D {\r\n    constructor() {\r\n        super();\r\n        this.speed = 2;\r\n        this._currentPathStep = 0;\r\n        this._derectVec = new Vector3();\r\n        this._pathTarget = new Vector3();\r\n        this.speedVec = new Vector3();\r\n    }\r\n    onAwake() {\r\n        super.onAwake();\r\n    }\r\n    onEnable() {\r\n        super.onEnable();\r\n        this.character = this.owner.sprite3dNode;\r\n    }\r\n    onDisable() {\r\n        super.onDisable();\r\n    }\r\n    onDestroy() {\r\n        super.onDestroy();\r\n    }\r\n    moveTo(path, complate) {\r\n        this._path = path;\r\n        if (!this.isMove)\r\n            this.isMove = true;\r\n        this.calcSpeed();\r\n    }\r\n    get isMove() {\r\n        return this._isMove;\r\n    }\r\n    set isMove(bool) {\r\n        if (bool) {\r\n            Laya.timer.loop(1, this, this.update);\r\n            this._isMove = true;\r\n            var a = this.character.getComponent(Animator);\r\n            a.play(CommonDefine.ANIMATION_WAKL);\r\n        }\r\n        else {\r\n            Laya.timer.clear(this, this.update);\r\n            this._isMove = false;\r\n            this.clear();\r\n            var a = this.character.getComponent(Animator);\r\n            a.play(CommonDefine.ANIMATION_IDLE);\r\n        }\r\n    }\r\n    stopMove() {\r\n        this.isMove = false;\r\n    }\r\n    update() {\r\n        if (!this._isMove)\r\n            return;\r\n        this.character.transform.position.x += this.speedVec.x * 0.01;\r\n        this.character.transform.position.y += this.speedVec.y * 0.01;\r\n        this.character.transform.position.z += this.speedVec.z * 0.01;\r\n        this.character.transform.position = this.character.transform.position;\r\n        if (this.checkArrived()) {\r\n            this.nextPoint();\r\n        }\r\n    }\r\n    nextPoint() {\r\n        this._currentPathStep += 1;\r\n        if (this._path.length <= this._currentPathStep) {\r\n            this.stopMove();\r\n            return;\r\n        }\r\n        this.calcSpeed();\r\n    }\r\n    checkArrived() {\r\n        if (Vector3.distance(this.character.transform.position, this._pathTarget) < 0.01)\r\n            return true;\r\n        return false;\r\n    }\r\n    calcSpeed() {\r\n        var targetPos = this._path[this._currentPathStep];\r\n        this._pathTarget.x = targetPos.x;\r\n        this._pathTarget.y = targetPos.y;\r\n        this._pathTarget.z = targetPos.z;\r\n        this._derectVec.x = this._pathTarget.x - this.character.transform.position.x;\r\n        this._derectVec.y = this._pathTarget.y - this.character.transform.position.y;\r\n        this._derectVec.z = this._pathTarget.z - this.character.transform.position.z;\r\n        Vector3.normalize(this._derectVec, this.speedVec);\r\n        Vector3.scale(this.speedVec, this.speed, this.speedVec);\r\n        this.calcOwnerAngleBySpeed(this._derectVec.x, this._derectVec.z);\r\n    }\r\n    calcOwnerAngleBySpeed(disX, disZ) {\r\n        this.character.transform.localRotationEulerY = Math.atan2(disX, disZ) * 180 / Math.PI;\r\n    }\r\n    clear() {\r\n        this._currentPathStep = 0;\r\n    }\r\n}\r\nMoveController.target = new Vector3();\r\n",
  "references": [
    "E:/project/duorou/client/src/common/CommonDefine.ts",
    "E:/project/duorou/client/src/game/npc/NpcBase.ts"
  ]
}
