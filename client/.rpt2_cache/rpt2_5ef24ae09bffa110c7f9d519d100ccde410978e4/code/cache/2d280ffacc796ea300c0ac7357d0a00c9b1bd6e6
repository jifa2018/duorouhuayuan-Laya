{
  "code": "var Sprite3D = Laya.Sprite3D;\r\nimport { Global } from \"../../utils/Global\";\r\nvar Vector3 = Laya.Vector3;\r\nvar Point = Laya.Point;\r\nvar MouseManager = Laya.MouseManager;\r\nvar Vector2 = Laya.Vector2;\r\nimport { CommonDefine } from \"../../common/CommonDefine\";\r\nimport { SoundManager } from \"../../manager/SoundManager\";\r\nexport default class MouseController extends Laya.Script3D {\r\n    constructor() {\r\n        super();\r\n        this.rotateEnable = false;\r\n        this.moveEnable = true;\r\n        this.scaleEnable = false;\r\n        this.testMusic = false;\r\n        this.movePoint = new Point();\r\n        this.hitResult = new Laya.HitResult();\r\n        this.ray = new Laya.Ray(new Vector3(0, 0, 0), new Vector3(0, 0, 0));\r\n    }\r\n    onAwake() {\r\n        this.emptyNode = new Sprite3D();\r\n        this.pressPoint = new Laya.Point();\r\n    }\r\n    onEnable() {\r\n        super.onEnable();\r\n        Laya.stage.on(Laya.Event.RIGHT_MOUSE_DOWN, this, this.rMouseDown);\r\n        Laya.stage.on(Laya.Event.RIGHT_MOUSE_UP, this, this.rMouseUp);\r\n        Laya.stage.on(Laya.Event.MOUSE_WHEEL, this, this.mouseWhell);\r\n        Laya.stage.on(Laya.Event.MOUSE_DOWN, this, this.mouseDown);\r\n        Laya.stage.on(Laya.Event.DOUBLE_CLICK, this, this.mouse2Down);\r\n        Laya.stage.on(Laya.Event.MOUSE_MOVE, this, this.mouseMove);\r\n        Laya.stage.on(Laya.Event.MOUSE_UP, this, this.mouseUp);\r\n        Laya.stage.on(Laya.Event.KEY_DOWN, this, this.mouseDown);\r\n        Laya.stage.on(Laya.Event.TRIGGER_EXIT, this, this.mouseUp);\r\n        Laya.stage.on(Laya.Event.CLICK, this, this.mouseClick);\r\n        this.isPress = false;\r\n    }\r\n    mouseClick(ev) {\r\n        let events = ev.target._events;\r\n        if (events && events.click) {\r\n            if (events.click.length == undefined || events.click.length < 2 || !events.click[0])\r\n                return;\r\n            let btn = events.click[0].caller;\r\n            if (!btn[\"stateNum\"])\r\n                return;\r\n            btn.scaleX = 1;\r\n            btn.scaleY = 1;\r\n            Laya.Tween.to(btn, { scaleX: 0.9, scaleY: 0.9 }, 100, Laya.Ease.linearIn, Laya.Handler.create(this, () => {\r\n                Laya.Tween.to(btn, { scaleX: 1, scaleY: 1 }, 100, Laya.Ease.linearIn, Laya.Handler.create(this, () => {\r\n                }));\r\n            }));\r\n        }\r\n        else {\r\n            this.hitName = this.checkHit();\r\n            if (this.hitResult.succeeded) {\r\n                console.log(\"========this.hitResult.collider.owner=======\", this.hitResult.collider.owner);\r\n            }\r\n        }\r\n    }\r\n    onDisable() {\r\n        super.onDisable();\r\n        Laya.stage.off(Laya.Event.RIGHT_MOUSE_DOWN, this, this.rMouseDown);\r\n        Laya.stage.off(Laya.Event.RIGHT_MOUSE_UP, this, this.rMouseUp);\r\n        Laya.stage.off(Laya.Event.MOUSE_WHEEL, this, this.mouseWhell);\r\n        Laya.stage.off(Laya.Event.MOUSE_DOWN, this, this.mouseDown);\r\n        Laya.stage.off(Laya.Event.MOUSE_MOVE, this, this.mouseMove);\r\n        Laya.stage.off(Laya.Event.MOUSE_UP, this, this.mouseUp);\r\n        Laya.stage.off(Laya.Event.KEY_DOWN, this, this.mouseDown);\r\n        Laya.stage.off(Laya.Event.TRIGGER_EXIT, this, this.mouseUp);\r\n        Laya.stage.off(Laya.Event.CLICK, this, this.mouseClick);\r\n    }\r\n    setCameraCenter(sp3d) {\r\n        this.camera = this.owner;\r\n        let temp = this.camera.transform.position.clone();\r\n        let parentNode = this.owner.parent;\r\n        this.emptyNode.addChild(this.camera);\r\n        parentNode.addChild(this.emptyNode);\r\n        this.emptyNode.transform.position = sp3d.transform.position.clone();\r\n        this.camera.transform.position = temp;\r\n    }\r\n    setTarget(target) {\r\n        this.lookTarget = target;\r\n    }\r\n    rMouseDown(e) {\r\n        this.isPress = true;\r\n        this.pressPoint.x = e[\"stageX\"];\r\n        this.pressPoint.y = e[\"stageX\"];\r\n    }\r\n    rMouseUp(e) {\r\n        this.isPress = false;\r\n    }\r\n    mouseWhell(e) {\r\n        if (!this.scaleEnable)\r\n            return;\r\n        if (e[\"delta\"] > 0) {\r\n            this.camera.fieldOfView -= 0.5;\r\n        }\r\n        else {\r\n            this.camera.fieldOfView += 0.5;\r\n        }\r\n    }\r\n    mouseDown(e) {\r\n        if (!this.testMusic) {\r\n            SoundManager.instance.playMusic(\"res/sound/bg.mp3\");\r\n            this.testMusic = true;\r\n        }\r\n        if (e.touches && e.touches.length > 1) {\r\n            var touches = e.touches;\r\n            this.lastDistance = Math.sqrt(Math.pow((touches[0].clientX - touches[1].clientX), 2) + Math.pow((touches[0].clientY - touches[1].clientY), 2));\r\n            return;\r\n        }\r\n        if (!this.rotateEnable) {\r\n            this.hitName = this.checkHit();\r\n        }\r\n        else {\r\n            this.isPress = true;\r\n        }\r\n        this.pressPoint.x = e[\"stageX\"];\r\n        this.pressPoint.y = e[\"stageX\"];\r\n    }\r\n    mouseMove(e) {\r\n        if (e.touches && e.touches.length > 1 && this.scaleEnable) {\r\n            var touches = e.touches;\r\n            var l = Math.sqrt(Math.pow((touches[0].clientX - touches[1].clientX), 2) + Math.pow((touches[0].clientY - touches[1].clientY), 2));\r\n            var len = this.lastDistance - l;\r\n            if (len > 0 && this.camera.orthographicVerticalSize > 6 || len < 0 && this.camera.orthographicVerticalSize < 3.5)\r\n                return;\r\n            ;\r\n            this.camera.orthographicVerticalSize += len / 40;\r\n            this.lastDistance = l;\r\n            this.pressPoint.x = e[\"stageX\"];\r\n            this.pressPoint.y = e[\"stageX\"];\r\n        }\r\n        else {\r\n            if (this.isPress && this.rotateEnable) {\r\n                let dist = this.pressPoint.x - e[\"stageX\"];\r\n                Global.tempVector3.x = 0;\r\n                Global.tempVector3.y = -dist / 5;\r\n                Global.tempVector3.z = 0;\r\n                this.lookTarget.transform.rotate(Global.tempVector3, true, false);\r\n                this.pressPoint.x = e[\"stageX\"];\r\n                this.pressPoint.y = e[\"stageX\"];\r\n            }\r\n        }\r\n    }\r\n    mouseUp(e) {\r\n        if (this.isPress)\r\n            this.isPress = false;\r\n        if (!this.moveEnable)\r\n            return;\r\n        this.isPress = false;\r\n        if (e[\"stageX\"] - this.pressPoint.x > 50) {\r\n            Laya.stage.event(CommonDefine.EVENT_ROLL_SCREEN, [\"right\", this.camera]);\r\n        }\r\n        else if (this.pressPoint.x - e[\"stageX\"] > 50) {\r\n            Laya.stage.event(CommonDefine.EVENT_ROLL_SCREEN, [\"left\", this.camera]);\r\n        }\r\n        if (this.hitName == this.checkHit() && this.hitName != null) {\r\n            Laya.stage.event(CommonDefine.EVENT_CLICK_TARGET, [this.hitName, this.camera]);\r\n        }\r\n    }\r\n    mouse2Down(e) {\r\n    }\r\n    checkHit() {\r\n        MouseController.clickPoint.x = MouseManager.instance.mouseX;\r\n        MouseController.clickPoint.y = MouseManager.instance.mouseY;\r\n        this.camera.viewportPointToRay(MouseController.clickPoint, this.ray);\r\n        this.camera.scene.physicsSimulation.rayCast(this.ray, this.hitResult);\r\n        if (this.hitResult.succeeded) {\r\n            return this.hitResult.collider.owner;\r\n        }\r\n        return null;\r\n    }\r\n}\r\nMouseController.clickPoint = new Vector2();\r\n",
  "references": [
    "E:/project/duorou/client/src/utils/Global.ts",
    "E:/project/duorou/client/src/game/scene/GameScene.ts",
    "E:/project/duorou/client/src/common/CommonDefine.ts",
    "E:/project/duorou/client/src/manager/SoundManager.ts",
    "E:/project/duorou/client/src/manager/SceneManager.ts",
    "E:/project/duorou/client/src/game/scene/ViewScene.ts",
    "E:/project/duorou/client/src/common/Debug.ts"
  ]
}
