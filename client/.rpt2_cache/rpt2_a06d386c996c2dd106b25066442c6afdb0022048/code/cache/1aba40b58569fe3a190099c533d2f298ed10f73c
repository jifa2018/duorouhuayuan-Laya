{
  "code": "var Vector4 = Laya.Vector4;\r\nimport { Singleton } from \"../common/Singleton\";\r\nimport { Utils } from \"../utils/Utils\";\r\nimport { PotManager } from \"./PotManager\";\r\nimport { GameUIManager } from \"./GameUIManager\";\r\nimport { FlowerpotSelView } from \"../game/ui/Flowerpot/FlowerpotSelView\";\r\nimport { PointFlowerStateView } from \"../game/ui/FlowerState/PointFlowerStateView\";\r\nimport { ConfigManager, Land_Cfg } from \"./ConfigManager\";\r\nimport { Player } from \"../game/player/Player\";\r\nimport { Debug } from \"../common/Debug\";\r\nimport GameScene from \"../game/scene/GameScene\";\r\nimport { unLockDialog } from \"../game/ui/Unlock/unLockDialog\";\r\nexport class LandManager extends Singleton {\r\n    constructor() {\r\n        super();\r\n        this._unlockedBottomArr = [];\r\n        this.initData();\r\n    }\r\n    initData() {\r\n        this._unlockedArr = Utils.getJSONFromLocal(\"landData\");\r\n        this._defaultLandJosnArr = ConfigManager.prototype.GetJsonToArray(Land_Cfg);\r\n        if (!this._unlockedArr) {\r\n            this._unlockedArr = new Array();\r\n            this._unlockedArr.push(\"0\");\r\n        }\r\n    }\r\n    onInitState(scene) {\r\n        this._scene = scene;\r\n        let landItemData;\r\n        for (let i = 0; i < this._defaultLandJosnArr.length; i++) {\r\n            landItemData = this._defaultLandJosnArr[i];\r\n            this.setLockState(landItemData.type, landItemData.strname, this._unlockedArr.indexOf(landItemData.id) == -1);\r\n        }\r\n    }\r\n    checkLandState(rat) {\r\n        let unlocklandDataArr = this._defaultLandJosnArr.filter((ele, index, array) => { return ele.strname == rat.name; });\r\n        let unlocklandData = unlocklandDataArr ? unlocklandDataArr[0] : null;\r\n        if (this._unlockedArr.indexOf(unlocklandData.id) != -1) {\r\n            if (unlocklandData.type == 1) {\r\n                this.OpenFlowerStateView(rat.name);\r\n            }\r\n        }\r\n        else if (unlocklandData && this._unlockedArr.indexOf(unlocklandData.preconditionID.toString()) != -1) {\r\n            GameUIManager.getInstance().createUI(unLockDialog, [unlocklandData, this.unlockLandPoint.bind(this)]);\r\n        }\r\n        else {\r\n            let precoditionDataArr = this._defaultLandJosnArr.filter((ele, index, array) => { return ele.id == unlocklandData.preconditionID; });\r\n            GameUIManager.getInstance().createUI(unLockDialog, [unlocklandData, this.unlockLandPoint.bind(this), precoditionDataArr[0].title]);\r\n        }\r\n    }\r\n    unlockLandPoint(unlockPointData) {\r\n        if (unlockPointData.unlockstar > Player.getInstance().nStar) {\r\n            Debug.Log(\"星星不够，无法解锁\");\r\n            return;\r\n        }\r\n        if (unlockPointData.gold > Player.getInstance().nGold) {\r\n            Debug.Log(\"金币不够，无法解锁\");\r\n            return;\r\n        }\r\n        this.setLockState(unlockPointData.type, unlockPointData.strname);\r\n        this._unlockedArr.push(unlockPointData.id);\r\n        Player.getInstance().nStar -= unlockPointData.unlockstar;\r\n        Player.getInstance().nGold -= unlockPointData.gold;\r\n        Player.getInstance().nStar += unlockPointData.star;\r\n        Player.getInstance().refreshStorage();\r\n        Utils.saveJSONToLocal(\"landData\", this._unlockedArr);\r\n    }\r\n    setLockState(type, strname, isActive = false, lockColor = new Vector4(0.5, 0.5, 0.5, 1)) {\r\n        let lockNode;\r\n        if (type == 1) {\r\n            lockNode = this._scene.getChildByName(\"zhongzhidian\");\r\n            lockNode = lockNode.getChildByName(strname);\r\n            let modelNode = lockNode.getChildAt(1);\r\n            modelNode.active = !isActive;\r\n            lockNode = lockNode.getChildAt(0);\r\n        }\r\n        else {\r\n            lockNode = this._scene.getChildByName(\"zhuangshiwu\");\r\n            lockNode = lockNode.getChildByName(strname);\r\n            if (!isActive) {\r\n                if (!this._unlockedBottomArr)\r\n                    this._unlockedBottomArr = new Array();\r\n                this._unlockedBottomArr.push(strname);\r\n                GameScene.instance.initSceneDecorates();\r\n                this._scene.getChildByName(\"point\").getChildByName(strname).getComponent(Laya.PhysicsCollider).enabled = false;\r\n            }\r\n        }\r\n        lockNode.active = isActive;\r\n    }\r\n    getBottomUnlockedArr() {\r\n        return this._unlockedBottomArr;\r\n    }\r\n    OpenFlowerStateView(name) {\r\n        if (!name)\r\n            return;\r\n        let tPoint = PotManager.getInstance().PotMap[name];\r\n        let potData = [];\r\n        let nLength = 0;\r\n        if (tPoint) {\r\n            for (const key in tPoint.PotList) {\r\n                nLength++;\r\n            }\r\n        }\r\n        if (nLength <= 0) {\r\n            GameUIManager.getInstance().createUI(FlowerpotSelView, [name, 0]);\r\n            return;\r\n        }\r\n        GameUIManager.getInstance().createUI(PointFlowerStateView, [name]);\r\n    }\r\n}\r\n//# sourceMappingURL=LandManager.js.map",
  "references": [
    "E:/project/duorou/client/src/common/Singleton.ts",
    "E:/project/duorou/client/src/utils/Utils.ts",
    "E:/project/duorou/client/src/manager/PotManager.ts",
    "E:/project/duorou/client/src/manager/GameUIManager.ts",
    "E:/project/duorou/client/src/game/ui/Flowerpot/FlowerpotSelView.ts",
    "E:/project/duorou/client/src/game/ui/FlowerState/PointFlowerStateView.ts",
    "E:/project/duorou/client/src/manager/ConfigManager.ts",
    "E:/project/duorou/client/src/game/player/Player.ts",
    "E:/project/duorou/client/src/common/Debug.ts",
    "E:/project/duorou/client/src/manager/SaveManager.ts",
    "E:/project/duorou/client/src/game/scene/GameScene.ts",
    "E:/project/duorou/client/src/game/ui/Unlock/unLockDialog.ts",
    "E:/project/duorou/client/src/game/item/BottomCreater.ts"
  ],
  "map": "{\"version\":3,\"file\":\"LandManager.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../src/manager/LandManager.ts\"],\"names\":[],\"mappings\":\"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\"}"
}
