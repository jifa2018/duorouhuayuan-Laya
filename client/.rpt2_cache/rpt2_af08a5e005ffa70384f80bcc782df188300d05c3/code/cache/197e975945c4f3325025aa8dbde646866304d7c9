{
  "code": "import { ViewState } from \"../game/GameDefine\";\r\nimport { Debug } from \"../common/Debug\";\r\nimport { Singleton } from \"../common/Singleton\";\r\nexport class ViewManager extends Singleton {\r\n    constructor() {\r\n        super(...arguments);\r\n        this._stateList = {};\r\n        this._UIViewList = {};\r\n        this._viewAtlasRes = {};\r\n        this._viewClassList = {};\r\n    }\r\n    OnStart() {\r\n        this._stateList = {};\r\n        this._viewClassList = {};\r\n    }\r\n    OnDestroy() {\r\n        this._stateList = {};\r\n    }\r\n    SaveViewResUrl(viewClass, resArray) {\r\n        if (!viewClass) {\r\n            Debug.LogError(\"加载UI资源参数有误！\");\r\n            return;\r\n        }\r\n        this._viewAtlasRes[viewClass.name] = resArray;\r\n    }\r\n    LoadViewAtlas(viewClass, loaded) {\r\n        let url = this._viewAtlasRes[viewClass.name];\r\n        if (url != null) {\r\n            Laya.loader.load(url, Laya.Handler.create(this, () => {\r\n                loaded.run();\r\n            }));\r\n        }\r\n        else {\r\n            loaded.run();\r\n        }\r\n    }\r\n    Adaptation(view) {\r\n        view.left = 0;\r\n        view.right = 0;\r\n        view.top = 0;\r\n        view.bottom = 0;\r\n    }\r\n    GetState(viewClass) {\r\n        if (!viewClass) {\r\n            Debug.LogError(\"查询UI状态有误！\");\r\n            return ViewState.None;\r\n        }\r\n        if (this._stateList[viewClass.name] == true) {\r\n            return ViewState.Loaded;\r\n        }\r\n        else if (this._stateList[viewClass.name] == false) {\r\n            return ViewState.Loading;\r\n        }\r\n        else {\r\n            return ViewState.None;\r\n        }\r\n    }\r\n    ShowUI(viewClass, hierarchy, params, callBack) {\r\n        if (!viewClass || !hierarchy) {\r\n            Debug.LogError(\"创建UI参数有误！\");\r\n            return;\r\n        }\r\n        if (this._stateList[viewClass.name] != null) {\r\n            Debug.LogError(\"此UI已经存在，创建失败！\");\r\n            return;\r\n        }\r\n        this._stateList[viewClass.name] = false;\r\n        let view = this._UIViewList[viewClass.name];\r\n        if (view == null) {\r\n            this._Create(viewClass, hierarchy, params, callBack);\r\n        }\r\n        else {\r\n            this._Show(viewClass, hierarchy);\r\n            if (callBack != null) {\r\n                callBack.runWith(view);\r\n            }\r\n        }\r\n    }\r\n    AddUI(viewClass, node, params, callBack) {\r\n        if (!viewClass || !node) {\r\n            Debug.LogError(\"添加UI参数有误！\");\r\n            return;\r\n        }\r\n        if (this._stateList[viewClass.name] != null) {\r\n            Debug.LogError(\"此UI已经存在，创建失败！\");\r\n            return;\r\n        }\r\n        this._stateList[viewClass.name] = false;\r\n        this._Create(viewClass, node, params, callBack);\r\n    }\r\n    HideUI(viewClass, hierarchy) {\r\n        if (!viewClass || !hierarchy) {\r\n            Debug.LogError(\"隐藏UI参数有误！\");\r\n            return;\r\n        }\r\n        this._Hide(viewClass, hierarchy);\r\n    }\r\n    DestroyUI(viewClass, hierarchy) {\r\n        if (!viewClass || !hierarchy) {\r\n            Debug.LogError(\"销毁UI参数有误！\");\r\n            return;\r\n        }\r\n        this._Destroy(viewClass, hierarchy);\r\n    }\r\n    _Create(viewClass, hierarchy, params, callBack) {\r\n        let __this = this;\r\n        function _load() {\r\n            let view = new viewClass(params);\r\n            view.name = viewClass.name;\r\n            hierarchy.addChild(view);\r\n            __this.Adaptation(view);\r\n            __this._viewClassList[view.name] = view;\r\n            __this._stateList[viewClass.name] = true;\r\n            __this._UIViewList[viewClass.name] = view;\r\n            if (callBack != null) {\r\n                callBack.runWith(view);\r\n            }\r\n        }\r\n        this.LoadViewAtlas(viewClass, Laya.Handler.create(this, () => {\r\n            _load();\r\n        }));\r\n    }\r\n    _Show(viewClass, hierarchy) {\r\n        let ui = hierarchy.getChildByName(viewClass.name);\r\n        if (ui != null) {\r\n            ui.visible = true;\r\n        }\r\n    }\r\n    _Hide(viewClass, hierarchy) {\r\n        let ui = hierarchy.getChildByName(viewClass.name);\r\n        if (ui != null) {\r\n            if (this._UIViewList[viewClass.name].OnHide) {\r\n                this._UIViewList[viewClass.name].OnHide();\r\n            }\r\n            delete this._stateList[viewClass.name];\r\n            ui.visible = false;\r\n        }\r\n    }\r\n    _Destroy(viewClass, hierarchy) {\r\n        let ui = hierarchy.getChildByName(viewClass.name);\r\n        if (ui != null) {\r\n            ui.destroy(true);\r\n            this._UIViewList[viewClass.name].offAll();\r\n            if (this._UIViewList[viewClass.name].OnDestroy) {\r\n                this._UIViewList[viewClass.name].OnDestroy();\r\n            }\r\n            delete this._viewClassList[viewClass.name];\r\n            delete this._stateList[viewClass.name];\r\n            delete this._UIViewList[viewClass.name];\r\n        }\r\n    }\r\n    GetViewByClass(viewClass) {\r\n        if (!viewClass) {\r\n            Debug.LogError(\"参数有误！\");\r\n            return;\r\n        }\r\n        return this._viewClassList[viewClass.name];\r\n    }\r\n    DestroyUIByHie(hierarchy) {\r\n        let viewIndex = [];\r\n        for (let _id = 0; _id < hierarchy.numChildren; _id++) {\r\n            let ui = hierarchy.getChildAt(_id);\r\n            if (ui != null) {\r\n                viewIndex.push(ui.name);\r\n            }\r\n        }\r\n        for (let key = 0; key < viewIndex.length; key++) {\r\n            let _viewName = viewIndex[key];\r\n            let ui = hierarchy.getChildByName(_viewName);\r\n            ui.destroy(true);\r\n            delete this._stateList[ui.name];\r\n            delete this._UIViewList[ui.name];\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=ViewManager.js.map",
  "references": [
    "E:/project/duorou/client/src/game/GameDefine.ts",
    "E:/project/duorou/client/src/common/Debug.ts",
    "E:/project/duorou/client/src/common/Singleton.ts"
  ],
  "map": "{\"version\":3,\"file\":\"ViewManager.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../src/manager/ViewManager.ts\"],\"names\":[],\"mappings\":\"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\"}"
}
