{
  "code": "var Script3D = Laya.Script3D;\r\nvar Vector3 = Laya.Vector3;\r\nimport { CommonDefine } from \"../../common/CommonDefine\";\r\nimport { Constant_Cfg } from \"../../manager/ConfigManager\";\r\nexport class MoveController extends Script3D {\r\n    constructor() {\r\n        super();\r\n        this.speed = 2;\r\n        this._currentPathStep = 0;\r\n        this._curDistance = 0;\r\n        this._distance = 0;\r\n        this._dirationX = 0;\r\n        this._dirationZ = -1;\r\n    }\r\n    onAwake() {\r\n        super.onAwake();\r\n    }\r\n    onEnable() {\r\n        super.onEnable();\r\n        this.character = this.owner;\r\n    }\r\n    onDisable() {\r\n        super.onDisable();\r\n    }\r\n    onDestroy() {\r\n        super.onDestroy();\r\n    }\r\n    get character() {\r\n        if (!this._character)\r\n            this.character = this.owner;\r\n        return this._character;\r\n    }\r\n    set character(c) {\r\n        this._character = c;\r\n    }\r\n    moveTo(wayPoint, complate = null, offset = 0) {\r\n        wayPoint = wayPoint.concat();\r\n        this._path = wayPoint;\r\n        if (this._path.length <= 0) {\r\n            console.log(\"移动数组为空\");\r\n            complate && complate.runWith(wayPoint.callback);\r\n            return;\r\n        }\r\n        this._finishArgs = wayPoint.callback;\r\n        this._offset = offset;\r\n        this._complate = complate;\r\n        this._currentPathStep = 0;\r\n        if (!this.isMove) {\r\n            this.isMove = true;\r\n        }\r\n        else {\r\n            this._keepMove = true;\r\n        }\r\n        this._path.unshift(this.character.transform.position.clone());\r\n        this._curDistance = 0;\r\n        this._distance = 0;\r\n        for (var a = 0; a < this._path.length - 1; a++) {\r\n            this._distance += Vector3.distance(this._path[a], this._path[a + 1]);\r\n        }\r\n    }\r\n    changSpeed(num) {\r\n        if (this.speed == num)\r\n            return;\r\n        this.speed = num;\r\n        this.isMove = this.isMove;\r\n    }\r\n    get isMove() {\r\n        return this._isMove;\r\n    }\r\n    set isMove(bool) {\r\n        if (bool) {\r\n            Laya.timer.loop(1, this, this.update);\r\n            this._isMove = true;\r\n            if (this.speed <= Constant_Cfg[12].value) {\r\n                this.character.playAnimation(CommonDefine.ANIMATION_WAKL);\r\n            }\r\n            else if (this.speed > Constant_Cfg[12].value) {\r\n                this.character.playAnimation(CommonDefine.ANIMATION_Run);\r\n            }\r\n        }\r\n        else {\r\n            Laya.timer.clear(this, this.update);\r\n            this._isMove = false;\r\n            this.character.playAnimation(CommonDefine.ANIMATION_IDLE);\r\n        }\r\n    }\r\n    stopMove() {\r\n        if (!this._keepMove)\r\n            this.isMove = false;\r\n    }\r\n    update() {\r\n        if (!this._isMove)\r\n            return;\r\n        this._curDistance += this.speed * Laya.timer.delta / 1000;\r\n        if (this._curDistance > this._distance) {\r\n            this._curDistance = this._distance;\r\n            this.isMove = false;\r\n            this.character.transform.position = this._path[this._path.length - 1];\r\n            this._complate && this._complate.run();\r\n            return;\r\n        }\r\n        let lastPoint = 0;\r\n        let dis = 0;\r\n        for (var a = 0; a < this._path.length - 1; a++) {\r\n            lastPoint = dis;\r\n            dis += Vector3.distance(this._path[a], this._path[a + 1]);\r\n            if (dis > this._curDistance) {\r\n                let section = this._curDistance - lastPoint;\r\n                let dir = new Vector3(0, 0, 0);\r\n                Vector3.subtract(this._path[a + 1], this._path[a], dir);\r\n                Vector3.normalize(dir, dir);\r\n                Vector3.scale(dir, section, dir);\r\n                var fin = new Vector3(0, 0, 0);\r\n                Vector3.add(this._path[a], dir, fin);\r\n                this.character.transform.position = fin;\r\n                this.calcOwnerAngleBySpeed(dir.x, dir.z);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    calcOwnerAngleBySpeed(disX, disZ) {\r\n        let roleSpeed = 5;\r\n        this._dirationX = this._dirationX + (disX - this._dirationX) * Laya.timer.delta / 1000 * roleSpeed;\r\n        this._dirationZ = this._dirationZ + (disZ - this._dirationZ) * Laya.timer.delta / 1000 * roleSpeed;\r\n        this.character.transform.localRotationEulerY = Math.atan2(this._dirationX, this._dirationZ) * 180 / Math.PI;\r\n    }\r\n}\r\nMoveController.target = new Vector3();\r\n//# sourceMappingURL=MoveController.js.map",
  "references": [
    "E:/project/duorou/client/src/common/CommonDefine.ts",
    "E:/project/duorou/client/src/game/npc/NpcBase.ts",
    "E:/project/duorou/client/src/common/Debug.ts",
    "E:/project/duorou/client/src/manager/ConfigManager.ts"
  ],
  "map": "{\"version\":3,\"file\":\"MoveController.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/game/script/MoveController.ts\"],\"names\":[],\"mappings\":\"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\"}"
}
