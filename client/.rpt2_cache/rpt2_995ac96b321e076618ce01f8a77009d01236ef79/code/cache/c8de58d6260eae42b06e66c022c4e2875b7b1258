{
  "code": "import { SaveManager, ModelStorage } from \"../../../../manager/SaveManager\";\r\nimport { gift_Cfg } from \"../../../../manager/ConfigManager\";\r\nimport { CommonDefine } from \"../../../../common/CommonDefine\";\r\nexport class getGoods {\r\n    constructor(pro) {\r\n        this.storage_time = 0;\r\n        this.init();\r\n        this._pro = pro;\r\n    }\r\n    init() {\r\n        this.getStorage();\r\n        this.goTime();\r\n    }\r\n    isGetGoods() {\r\n        let _new_time = Laya.Browser.now() / 1000;\r\n        let _dTime = _new_time - this.storage_time;\r\n        let mm = this.curGoodsTime * 60;\r\n        if (_dTime > mm) {\r\n            Laya.stage.event(CommonDefine.EVENT_MAIN_GOODS_EVENT, [true, 0, this.curGoodsId, this.curGoodsNum]);\r\n            Laya.timer.clearAll(this);\r\n        }\r\n        else {\r\n            Laya.stage.event(CommonDefine.EVENT_MAIN_GOODS_EVENT, [false, mm - _dTime, this.curGoodsId, this.curGoodsNum]);\r\n        }\r\n        return [_dTime, mm];\r\n    }\r\n    startTime() {\r\n        let _d = gift_Cfg[this.curId + 1];\r\n        this.curId = _d ? this.curId + 1 : this.curId;\r\n        this.setTime();\r\n        this.goTime();\r\n    }\r\n    goTime() {\r\n        Laya.timer.loop(1000, this, () => {\r\n            let arr = this.isGetGoods();\r\n            this.setProValue(arr[0], arr[1]);\r\n        });\r\n    }\r\n    setProValue(cTime, sTime) {\r\n        let _vaule = 1 - cTime / sTime;\r\n        this._pro.value = _vaule;\r\n    }\r\n    setTime() {\r\n        let data = {\r\n            time: Laya.Browser.now() / 1000,\r\n            curId: this.curId,\r\n        };\r\n        SaveManager.getInstance().SetGoodsTime(data);\r\n        this.getStorage();\r\n    }\r\n    getStorage() {\r\n        let data = SaveManager.getInstance().GetCache(ModelStorage.SgoodsTime);\r\n        if (data) {\r\n            this.storage_time = data.time;\r\n            this.curId = data.curId;\r\n        }\r\n        else {\r\n            this.storage_time = Laya.Browser.now() / 1000;\r\n            this.curId = 1;\r\n            let data = {\r\n                time: this.storage_time,\r\n                curId: this.curId,\r\n            };\r\n            SaveManager.getInstance().SetGoodsTime(data);\r\n        }\r\n        this.curGoodsId = gift_Cfg[this.curId].itemID;\r\n        this.curGoodsTime = gift_Cfg[this.curId].time;\r\n        this.curGoodsNum = gift_Cfg[this.curId].num;\r\n    }\r\n}\r\n//# sourceMappingURL=GetGoods.js.map",
  "references": [
    "E:/project/duorou/client/src/manager/SaveManager.ts",
    "E:/project/duorou/client/src/manager/ConfigManager.ts",
    "E:/project/duorou/client/src/common/CommonDefine.ts"
  ],
  "map": "{\"version\":3,\"file\":\"GetGoods.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/game/ui/Main/GetGoods/GetGoods.ts\"],\"names\":[],\"mappings\":\"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\"}"
}
