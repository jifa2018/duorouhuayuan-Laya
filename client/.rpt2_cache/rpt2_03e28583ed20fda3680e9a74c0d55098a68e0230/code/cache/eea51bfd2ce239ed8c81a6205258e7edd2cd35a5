{
  "code": "import { Bottom } from \"./Bottom\";\r\nimport { Utils } from \"../../utils/Utils\";\r\nimport { LocalStorage } from \"../GameDefine\";\r\nimport { CommonDefine } from \"../../common/CommonDefine\";\r\nimport { Singleton } from \"../../common/Singleton\";\r\nimport { ConfigManager, DefaultStatue_Cfg, Statue_Cfg } from \"../../manager/ConfigManager\";\r\nimport { Debug } from \"../../common/Debug\";\r\nimport { Player } from \"../player/Player\";\r\nimport { SaveManager, ModelStorage } from \"../../manager/SaveManager\";\r\nimport { LandManager } from \"../../manager/LandManager\";\r\nexport class BottomCreater extends Singleton {\r\n    constructor() {\r\n        super();\r\n        this._bottomList = new Array();\r\n        this._curSelectBottom = null;\r\n        this.maxBottomUpLv = 0;\r\n        Laya.stage.on(CommonDefine.EVENT_BOTTOM, this, this.createSceneDecorates);\r\n        Laya.stage.on(CommonDefine.EVENT_BOTTOM_LEVEL_UP, this, this.bottomLevelUp);\r\n        let _arr = ConfigManager.prototype.GetJsonToArray(Statue_Cfg);\r\n        _arr.forEach(element => {\r\n            if (element.StatueType == 1) {\r\n                this.maxBottomUpLv = element.lv;\r\n            }\r\n        });\r\n        this.statueArray = ConfigManager.prototype.GetJsonToArray(Statue_Cfg);\r\n        this.defaultStatueArray = ConfigManager.prototype.GetJsonToArray(DefaultStatue_Cfg);\r\n    }\r\n    curSelectBottom(b) {\r\n        this._curSelectBottom = b;\r\n    }\r\n    clearSelectBottom() {\r\n        this._curSelectBottom = null;\r\n    }\r\n    createBottom(data) {\r\n        var bottom = new Bottom();\r\n        bottom.init(data);\r\n        this._bottomList.push(bottom);\r\n        return bottom;\r\n    }\r\n    getDefaultData() {\r\n        let nodeArr = LandManager.getInstance().getBottomUnlockedArr();\r\n        let nCurDecorateId = this.getDefaulSelectDecorate();\r\n        let defauleData = [];\r\n        nodeArr.forEach(ele => {\r\n            let statueData = this.getStatueItemData(1);\r\n            let d = {\r\n                parentName: ele,\r\n                bLevel: 1,\r\n                bId: statueData.id,\r\n                attraction: statueData.attraction,\r\n                star: 0,\r\n                curDecorateId: nCurDecorateId,\r\n                curDecorateInfo: {\r\n                    state: false,\r\n                    time: 0\r\n                },\r\n                unLockDecorates: [nCurDecorateId]\r\n            };\r\n            defauleData.push(d);\r\n        });\r\n        return defauleData;\r\n    }\r\n    getDefaulSelectDecorate() {\r\n        for (const key in Statue_Cfg) {\r\n            if (Object.prototype.hasOwnProperty.call(Statue_Cfg, key)) {\r\n                const element = Statue_Cfg[key];\r\n                if (element.StatueType > 1) {\r\n                    return element.id;\r\n                }\r\n            }\r\n        }\r\n        console.log(\"err：===========表格中配置错误====方法：getDefaulSelectDecorate==========\");\r\n    }\r\n    getStatueItemData(_lv) {\r\n        for (let index = 0; index < this.statueArray.length; index++) {\r\n            const element = this.statueArray[index];\r\n            if (element.lv == _lv) {\r\n                return element;\r\n            }\r\n        }\r\n    }\r\n    getPooledData(_initData) {\r\n        let data = _initData;\r\n        let sData = SaveManager.getInstance().GetCache(ModelStorage.Bottom);\r\n        sData = sData || (sData = []);\r\n        sData.forEach(element => {\r\n            for (let index = 0; index < data.length; index++) {\r\n                if (data[index].parentName == element.parentName) {\r\n                    data[index] = element;\r\n                }\r\n            }\r\n        });\r\n        this._bottomList.forEach((element, index) => {\r\n            for (let index = 0; index < data.length; index++) {\r\n                ;\r\n                if (data[index].parentName == element._name) {\r\n                    data.splice(index, 1);\r\n                }\r\n            }\r\n        });\r\n        return data;\r\n    }\r\n    createByData(data, scene) {\r\n        let arr = this.getPooledData(data);\r\n        arr.forEach(element => {\r\n            let _parent = scene.getChildByName(\"point\").getChildByName(element.parentName);\r\n            if (!_parent) {\r\n                Utils.clearLocalByKey(LocalStorage.Bottom);\r\n                Debug.Log(\"存在旧数据，已自动清除，请刷新\");\r\n            }\r\n            else {\r\n                _parent.active = true;\r\n                let bottom = this.createBottom(element);\r\n                bottom.transform.rotationEuler = new Laya.Vector3(0, bottom.transform.rotationEuler.y + 180, 0);\r\n                _parent.destroyChildren();\r\n                _parent.addChild(bottom);\r\n            }\r\n        });\r\n    }\r\n    createSceneDecorates() {\r\n        this._curSelectBottom.addDecorate();\r\n        this.refreshData();\r\n        Laya.stage.event(CommonDefine.EVENT_BOTTOM_REFRESH);\r\n    }\r\n    bottomLevelUp() {\r\n        let parentName = this._curSelectBottom._name;\r\n        for (let index = 0; index < this._bottomList.length; index++) {\r\n            const e = this._bottomList[index];\r\n            if (e._name == parentName) {\r\n                let cmp = Statue_Cfg[e._bId];\r\n                e.onLevelUp(this.maxBottomUpLv);\r\n                this.deductCost(cmp);\r\n                e.addStar(cmp.GiveStar);\r\n                e.addAttraction(cmp.attraction);\r\n                break;\r\n            }\r\n        }\r\n        this.refreshData();\r\n        Laya.stage.event(CommonDefine.EVENT_BOTTOM_REFRESH);\r\n    }\r\n    unLockDecorate(_id) {\r\n        let cmp = Statue_Cfg[_id];\r\n        this._curSelectBottom.unLockDecoratesById(_id);\r\n        this._curSelectBottom.addStar(cmp.GiveStar);\r\n        this._curSelectBottom.addAttraction(cmp.attraction);\r\n        this.deductCost(cmp);\r\n        this.refreshData();\r\n        Laya.stage.event(CommonDefine.EVENT_BOTTOM_REFRESH);\r\n    }\r\n    deductCost(cmp) {\r\n        Player.getInstance().refreshStar(cmp.GiveStar);\r\n        Player.getInstance().refreshGold(-cmp.UnlockGold);\r\n    }\r\n    refreshData() {\r\n        let _data = [];\r\n        this._bottomList.forEach(_e => {\r\n            let _curDecorateInfo = {};\r\n            if (_e._curDecorate) {\r\n                _curDecorateInfo[\"state\"] = _e._curDecorate.state;\r\n                _curDecorateInfo[\"time\"] = _e._curDecorate.time;\r\n            }\r\n            let item = {\r\n                parentName: _e._name,\r\n                bLevel: _e._level,\r\n                bId: _e._bId,\r\n                attraction: _e._attraction,\r\n                star: _e._star,\r\n                curDecorateId: _e._curDecorateId,\r\n                curDecorateInfo: _curDecorateInfo,\r\n                unLockDecorates: _e._unLockDecorates\r\n            };\r\n            _data.push(item);\r\n        });\r\n        SaveManager.getInstance().SetBottomCache(_data);\r\n    }\r\n    getBottomList() {\r\n        return this._bottomList;\r\n    }\r\n}\r\n//# sourceMappingURL=BottomCreater.js.map",
  "references": [
    "E:/project/duorou/client/src/game/item/Bottom.ts",
    "E:/project/duorou/client/src/game/scene/GameScene.ts",
    "E:/project/duorou/client/src/utils/Utils.ts",
    "E:/project/duorou/client/src/GameConfig.ts",
    "E:/project/duorou/client/src/game/GameDefine.ts",
    "E:/project/duorou/client/src/common/CommonDefine.ts",
    "E:/project/duorou/client/src/common/Singleton.ts",
    "E:/project/duorou/client/src/manager/ConfigManager.ts",
    "E:/project/duorou/client/src/common/Debug.ts",
    "E:/project/duorou/client/src/game/player/Player.ts",
    "E:/project/duorou/client/src/manager/SaveManager.ts",
    "E:/project/duorou/client/src/manager/LandManager.ts"
  ],
  "map": "{\"version\":3,\"file\":\"BottomCreater.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/game/item/BottomCreater.ts\"],\"names\":[],\"mappings\":\"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\"}"
}
