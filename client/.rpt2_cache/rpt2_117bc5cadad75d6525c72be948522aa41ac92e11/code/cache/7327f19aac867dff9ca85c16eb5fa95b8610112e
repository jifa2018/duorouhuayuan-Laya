{
  "code": "var Pool = Laya.Pool;\r\nimport { VisitorNpc } from \"../game/npc/VisitorNpc\";\r\nimport { Singleton } from \"../common/Singleton\";\r\nimport { Utils } from \"../utils/Utils\";\r\nvar Vector3 = Laya.Vector3;\r\nimport { Constant_Cfg } from \"./ConfigManager\";\r\nimport { NpcCreater } from \"../game/component/NpcCreater\";\r\nimport { GameUIManager } from \"./GameUIManager\";\r\nimport { TipViewScene } from \"../game/ui/Common/TipViewScene\";\r\nimport { GuideNpc } from \"../game/npc/GuideNpc\";\r\nexport class NpcManager extends Singleton {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.NpcArray = new Array();\r\n        this.MaxNpcCount = 30;\r\n    }\r\n    onInit() {\r\n        this.npcCreater = new NpcCreater();\r\n    }\r\n    onUpdata() {\r\n        if (this.NpcArray.length != null) {\r\n            this.NpcArray.forEach(element => {\r\n                element.onUpdate();\r\n            });\r\n        }\r\n        if (this.npcCreater)\r\n            this.npcCreater.stopCreater = this.NpcArray.length >= this.MaxNpcCount ? false : true;\r\n    }\r\n    onDestroy() {\r\n        if (!this.npcCreater)\r\n            return;\r\n        this.npcCreater.clearCreater();\r\n        this.npcCreater = null;\r\n    }\r\n    initnpcCreater() {\r\n        if (this.npcCreater) {\r\n            this.npcCreater.initCreater();\r\n            this.npcCreater.stop = true;\r\n        }\r\n    }\r\n    destroynpcCreater() {\r\n        if (!this.npcCreater)\r\n            return;\r\n        this.npcCreater.stop = false;\r\n    }\r\n    createNpc(tableId) {\r\n        if (this.NpcArray.length >= this.MaxNpcCount) {\r\n            GameUIManager.getInstance().createTopUI(TipViewScene, [null, \"游客最多30个！\", false]);\r\n            return;\r\n        }\r\n        var npc = Pool.getItemByClass(\"NpcBase\", VisitorNpc);\r\n        npc.createById(tableId);\r\n        this.NpcArray.push(npc);\r\n        return npc;\r\n    }\r\n    createGuideNpc(tableId) {\r\n        var npc = Pool.getItemByClass(\"NpcBase\", GuideNpc);\r\n        npc.createById(tableId);\r\n        this.NpcArray.push(npc);\r\n        return npc;\r\n    }\r\n    recoverNpc(clsName, cls) {\r\n        Utils.remove(this.NpcArray, cls);\r\n        Pool.recover(clsName, cls);\r\n    }\r\n    isContainMarplot(pos) {\r\n        let hasElement = false;\r\n        this.NpcArray.forEach(element => {\r\n            if (element.type == 4) {\r\n                if (Vector3.distance(pos, element.transform.position) < Constant_Cfg[7].value) {\r\n                    hasElement = true;\r\n                    return true;\r\n                }\r\n            }\r\n        });\r\n        return hasElement;\r\n    }\r\n    driveAwayVisitors(pos) {\r\n        let array = new Array();\r\n        this.NpcArray.forEach(element => {\r\n            if (element.type != 4 && element.type != 3) {\r\n                if (Vector3.distance(pos, element.transform.position) < Constant_Cfg[7].value) {\r\n                    array.push(element);\r\n                }\r\n            }\r\n        });\r\n        return array;\r\n    }\r\n    nordriveAwayVisitors(pos) {\r\n        for (let index = 0; index < this.NpcArray.length; index++) {\r\n            const element = this.NpcArray[index];\r\n            if (element.type == 4 && !element.Fadeaway) {\r\n                let dis = Vector3.distance(pos, element.transform.position);\r\n                if (dis < Constant_Cfg[7].value) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n}\r\n//# sourceMappingURL=NpcManager.js.map",
  "references": [
    "E:/project/duorou/client/src/game/npc/NpcBase.ts",
    "E:/project/duorou/client/src/game/npc/VisitorNpc.ts",
    "E:/project/duorou/client/src/common/Singleton.ts",
    "E:/project/duorou/client/src/utils/Utils.ts",
    "E:/project/duorou/client/src/manager/ConfigManager.ts",
    "E:/project/duorou/client/src/manager/IManager.ts",
    "E:/project/duorou/client/src/game/component/NpcCreater.ts",
    "E:/project/duorou/client/src/manager/GameUIManager.ts",
    "E:/project/duorou/client/src/game/ui/Common/TipViewScene.ts",
    "E:/project/duorou/client/src/game/npc/GuideNpc.ts"
  ],
  "map": "{\"version\":3,\"file\":\"NpcManager.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../src/manager/NpcManager.ts\"],\"names\":[],\"mappings\":\"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\"}"
}
