{
  "code": "import { Singleton } from \"../common/Singleton\";\r\nimport { Utils } from \"../utils/Utils\";\r\nimport { SaveManager, ModelStorage } from \"./SaveManager\";\r\nexport class CollectMapDataManager extends Singleton {\r\n    constructor() {\r\n        super();\r\n        this._mapData = [];\r\n        this._mapData[1] = [];\r\n    }\r\n    init(scene3d) {\r\n        var str = SaveManager.getInstance().GetCache(ModelStorage.mapData);\r\n        if (str) {\r\n            var js = JSON.parse(str);\r\n            var arr1 = new Array();\r\n            for (var o in js) {\r\n                var tempArr = new Array();\r\n                if (js[o] instanceof Object) {\r\n                    for (var i in js[o]) {\r\n                        tempArr[i] = js[o][i];\r\n                    }\r\n                    arr1[Number(o)] = tempArr;\r\n                }\r\n                else {\r\n                    arr1[Number(o)] = js[o];\r\n                }\r\n            }\r\n            this._mapData = arr1;\r\n        }\r\n        this._scene3d = scene3d;\r\n        this.refreshMapData();\r\n    }\r\n    refreshMapData() {\r\n        var node = this._scene3d;\r\n        if (!node)\r\n            return;\r\n        var nodeName;\r\n        var child;\r\n        for (var i = 1; i < 11; ++i) {\r\n            nodeName = \"1_\" + i.toString() + \"_collectpoint\";\r\n            child = node.getChildByName(nodeName);\r\n            if (!child)\r\n                continue;\r\n            if (this._mapData[1][i]) {\r\n                this.setLockState(1, i, true);\r\n            }\r\n            else {\r\n                this.setLockState(1, i, false);\r\n            }\r\n        }\r\n    }\r\n    getMaxMapLevel(mapId) {\r\n        if (!this._mapData[mapId])\r\n            return 0;\r\n        return this._mapData[mapId][this._mapData[mapId].length - 1];\r\n    }\r\n    unLockMapData(mapId, openArea) {\r\n        if (!this._mapData[mapId])\r\n            this._mapData[mapId] = [];\r\n        this._mapData[mapId][openArea] = openArea;\r\n        this.setLockState(mapId, openArea, true);\r\n        this.saveData();\r\n    }\r\n    setLockState(mapId, area, bUnLock = false) {\r\n        var nodeName = mapId.toString() + \"_\" + area.toString() + \"_collectpoint\";\r\n        var child = this._scene3d.getChildByName(nodeName);\r\n        if (!child)\r\n            return;\r\n        var lock = child.getChildByName(\"suo\");\r\n        if (!lock)\r\n            return;\r\n        if (!bUnLock) {\r\n            Utils.setModelbrightness(child, 0.5);\r\n            Utils.setModelbrightness(lock, 1);\r\n        }\r\n        else {\r\n            lock.active = false;\r\n            Utils.setModelbrightness(child, 1);\r\n        }\r\n    }\r\n    getLock(name) {\r\n        var mapId = Number(name.substr(0, name.indexOf(\"_\")));\r\n        var area = Number(name.substr(name.indexOf(\"_\") + 1, name.lastIndexOf(\"_\") - 2));\r\n        if (!this._mapData[mapId] || !this._mapData[mapId][area])\r\n            return false;\r\n        return true;\r\n    }\r\n    saveData() {\r\n        var arr = {};\r\n        for (var o in this._mapData) {\r\n            if (this._mapData[o]) {\r\n                if (this._mapData[o] instanceof Array) {\r\n                    let oTemp = {};\r\n                    for (var key in this._mapData[o]) {\r\n                        oTemp[key] = this._mapData[o][key];\r\n                    }\r\n                    arr[o] = oTemp;\r\n                }\r\n                else {\r\n                    arr[o] = this._mapData[o];\r\n                }\r\n            }\r\n        }\r\n        let str = JSON.stringify(arr);\r\n        SaveManager.getInstance().SetmapDataCache(str);\r\n    }\r\n}\r\n//# sourceMappingURL=CollectMapDataManager.js.map",
  "references": [
    "E:/project/duorou/client/src/common/Singleton.ts",
    "E:/project/duorou/client/src/utils/Utils.ts",
    "E:/project/duorou/client/src/manager/SaveManager.ts"
  ],
  "map": "{\"version\":3,\"file\":\"CollectMapDataManager.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../src/manager/CollectMapDataManager.ts\"],\"names\":[],\"mappings\":\"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\"}"
}
